use std::path::PathBuf;

fn main() -> anyhow::Result<()> {
    let router = alloy_control::rpc::router();
    let (_procedures, types) = router
        .build()
        .map_err(|errs| anyhow::anyhow!("rspc build failed: {errs:?}"))?;

    // Generate a deterministic file committed into the repo.
    let out_path = PathBuf::from(env!("CARGO_MANIFEST_DIR")).join("../../web/src/bindings.ts");

    rspc::Typescript::default()
        .header("// Generated by `cargo run -p alloy-control --bin export_rspc_bindings`.\n")
        .export_to(out_path, &types)?;

    Ok(())
}
